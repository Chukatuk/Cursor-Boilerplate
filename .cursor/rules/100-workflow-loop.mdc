---
description: Enforces the Plan-then-Act workflow loop for large tasks. The AI must plan and get human approval before making major changes. Always active.
alwaysApply: true
---

# Workflow Loop: Plan and Act

Large tasks require a plan. Small tasks can proceed directly.

## When to plan

A formal plan is required when a task:
- Touches **3 or more files**
- Involves **architectural or structural decisions** (new patterns, major refactors, DB schema changes)
- Has **multiple valid approaches** with meaningful trade-offs

Everything else — bug fixes, small features in 1-2 files, config changes, lookups — proceed directly.

## Phase 1 — PLAN

1. Read the relevant memory bank files (`projectbrief.md`, `techContext.md`, `activeContext.md`, and optionally `systemPatterns.md`).
2. Draft a step-by-step plan: name the files, functions, and commands involved.
3. Present the plan. Start the response with `# Mode: PLAN`.
4. **Do not modify any files during this phase.**

## Phase 2 — ACT

**Trigger**: Human approves the plan.

1. Execute the plan step by step.
2. If something unexpected arises that changes the plan, stop and surface the issue before continuing.
3. After completion, update `memory-bank/activeContext.md` with what was done and next steps.
4. Log the change (see `200-context-preservation.mdc`).

## Aborting mid-act

If the plan turns out to be wrong or incomplete:
1. Stop immediately.
2. Describe the issue.
3. Return to Plan — do not improvise.
